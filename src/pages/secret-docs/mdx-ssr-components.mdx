---
title: MDX with SSR Web Components
description: Using web components with declarative shadow DOM in MDX
layout: project:layouts/docs/docs-layout.astro
---

import { SSRCard } from 'project:components/ssr-card.js';
import { polyfillDeclarativeShadowDOM, registerSSRComponent } from 'project:utils/shadow-dom-polyfill.js';

# SSR Web Components with Declarative Shadow DOM

This example demonstrates how to use web components with declarative shadow DOM in MDX files.
These components work with server-side rendering without requiring a React wrapper.

## How Declarative Shadow DOM Works

Declarative Shadow DOM is a web platform feature that allows Shadow DOM to be created using HTML
rather than JavaScript. It's perfect for server-side rendering since it doesn't require JavaScript
to run on the client before the component renders correctly.

<script>
  // Optional polyfill for older browsers - modern browsers (Chrome 90+, Safari 16.4+, Firefox 123+)
  // already support declarative shadow DOM natively
  polyfillDeclarativeShadowDOM(false); // Set to true to force polyfill
  
  // Register the web component
  registerSSRComponent('ssr-card', SSRCard);
</script>

## Direct SSR Rendering

The examples below use the `set:html` directive to inject HTML with declarative shadow DOM:

<div set:html={SSRCard.renderToString({ 
  title: 'Server Rendered Card',
  variant: 'primary',
  icon: 'info'
})}>
  This content is server-rendered with declarative shadow DOM.
</div>

<div set:html={SSRCard.renderToString({ 
  title: 'Success Card',
  variant: 'success',
  icon: 'success'
})}>
  <p>Server-rendered components still support slots for content projection.</p>
  <ul>
    <li>Content is styled by the light DOM</li>
    <li>But presented within the shadow DOM structure</li>
    <li>This allows for component encapsulation</li>
  </ul>
</div>

## Using the Component Directly

After the component is registered, you can also use it directly:

<ssr-card title="Warning Example" variant="warning" icon="warning">
  This component is using client-side registration but still works with SSR
  thanks to the declarative shadow DOM support.
</ssr-card>

<ssr-card title="Danger Alert" variant="danger" icon="danger">
  <p>This shows how regular MDX content can be used inside web components.</p>
  <p>The component is defined once but can be used in multiple places:</p>
  
  ```js
  // Register the component once
  customElements.define('ssr-card', SSRCard);
  
  // Use it many times
  <ssr-card title="Example">Content</ssr-card>
  ```
</ssr-card>

## Custom Styling

Components with shadow DOM are encapsulated, but you can still apply some styling
to the container element through the light DOM:

<div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
  <ssr-card 
    title="Card with Custom Width" 
    variant="primary"
    icon="star"
    style={{ flex: '1 1 200px' }}
  >
    This card has a custom width through light DOM styles.
  </ssr-card>
  
  <ssr-card 
    title="Another Custom Card" 
    variant="success" 
    icon="help"
    style={{ flex: '1 1 200px' }}
  >
    Components maintain their styling encapsulation while allowing for custom layouts.
  </ssr-card>
</div>

## Comparing Approaches

Here's a comparison of the different ways to use web components in Astro:

| Feature | React Wrapper | Declarative Shadow DOM |
|---------|---------------|------------------------|
| **SSR Support** | ✅ Via React | ✅ Native |
| **No JS Required** | ❌ Needs hydration | ✅ Works without JS |
| **Framework Independence** | ❌ Needs React | ✅ Pure web standards |
| **Ease of Use** | ✅ Simple | ⚠️ More complex |
| **Browser Support** | ✅ All browsers | ✅ Modern browsers (Chrome 90+, Safari 16.4+, Firefox 123+) |
| **Legacy Browser Support** | ✅ Via React | ⚠️ Needs optional polyfill |
| **Best For** | Interactive components | Static/core components |

## How This Works Behind the Scenes

1. During build time, Astro processes the MDX file
2. For `set:html` sections, it includes the declarative shadow DOM HTML directly
3. For direct component usage, it renders the base element that gets upgraded on the client
4. In modern browsers (Chrome 90+, Safari 16.4+, Firefox 123+), declarative shadow DOM works natively
5. In older browsers, the optional polyfill attaches shadow roots as needed
6. The component then behaves like any other web component, but with proper SSR support

### Browser Support Note

As of 2024, declarative shadow DOM is supported in:

- **Chrome/Edge**: Version 90+ (April 2021+)
- **Safari**: Version 16.4+ (March 2023+)
- **Firefox**: Version 123+ (February 2024+)

For most developer-focused sites, you can safely rely on native support without the polyfill. The polyfill is mainly needed for supporting older browsers or ensuring maximum compatibility.