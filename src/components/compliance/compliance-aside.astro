---
import { For, When } from '@astropub/flow'
import { markdown } from '@astropub/md'
import './compliance-aside.css'
import compliance from 'project:data/compliance.json'
export interface Props {
	title: string,
	compliance: typeof import('project:data/compliance.json')
}

const { isArray } = Array
const toNumeral = (content: any, ruleset: any, rule: any) => [ content.numeral, ruleset.numeral, rule.numeral].join('.')
const toStatusClass = (rule: any) => `status -${rule.status}`

const props = Astro.props as Props
---

<aside class="compliance">
<header><span class="compliance-header">Compliance Requirements</span> <span class="compliance-version">(v{ props.compliance.version })</span></header>
    <For of={props.compliance.contents}>{content => (
        <section class="p-compliance">
            <When {isArray(content.rulesets)}>
                <For of={content.rulesets!}>{ruleset => (
                    <section class="ruleset">
                        <When {isArray(ruleset.rules)}>
                            <For of={ruleset.rules!}> {async rule => (
                                <dl class="rule">
                                    <dd class="numeral">{toNumeral(content, ruleset, rule)}</dd>
                                    <div class="rule-text">
                                        <dt class="rule"> 
                                            {await markdown(rule.rule)} </dt>
                                        <When {rule.status !=='current'} and {rule.status !=='updated'} and {rule.status !=='under-review'}>
                                            <dd class={toStatusClass(rule)}>{rule.status} </dd>
                                        </When>
                                    </div>
                                </dl>
                                )}
                            </For>
                        </When>
                    </section>
                    )}
                </For>
            </When>
        </section>
        )}
    </For>
    <footer>
        <a href="/design-guidelines/compliance/">See all EGS Compliance Requirements</a>
      </footer>
  </aside>
