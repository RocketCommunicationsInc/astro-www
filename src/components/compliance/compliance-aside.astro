---
import { For, When } from '@astropub/flow'

import './compliance.css'

export interface Props {
    title: string,
    compliance: typeof import('project:data/compliance.json')
}

const { isArray } = Array
const toNumeral = (content: any, ruleset: any, rule: any) => [ content.numeral, ruleset.numeral, rule.numeral].join('.')
const toStatusClass = (rule: any) => `status -${rule.status}`

const props = Astro.props as Props
---
<!-- TODO : Make each compliance rule show on it's respective page -->

<aside class="compliance">
    <For of={props.compliance.contents}>{content => (
        <section class="p-compliance">
            <When {isArray(content.rules)}>
                <For of={content.rules!}>{rule => (
                    <dl>
                    </dl>
                )}</For>
            </When>
            <When {isArray(content.rulesets)}>
                <For of={content.rulesets!}>{ruleset => (
                    <section class="ruleset">
                        <When {isArray(ruleset.rules)}>
                            <For of={ruleset.rules!}>{rule => (
                                <dl class="rule">
                                    <dd class="numeral">{toNumeral(content, ruleset, rule)}</dd>
                                    <div class="rule-text">
                                    <dt class="rule">{rule.rule}</dt> 
                                    <When {rule.status !== 'current', 'updated', 'under-review'}>
                                        <dd class={toStatusClass(rule)} >{rule.status}</dd>
                                    </When>
                                    </div>
                                </dl>
                            )}</For>
                        </When>
                    </section>
                )}</For>
            </When>
        </section>
    )}</For>
  </aside>
