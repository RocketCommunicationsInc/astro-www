[build]
	publish = "dist/"
	command = "npm run build"
    functions = "netlify/functions"
    edge_functions = "netlify/edge-functions"

[context.production]
	NODE_VERSION = "18.16.0"

[context.deploy-preview.environment]
	NODE_VERSION = "18.16.0"

[[redirects]]
  from = '/api/*'
  to = '/.netlify/functions/:splat'
  status = 200

[[redirects]]
	from = "/ui-components/*"
	to = "/components/:splat"
	status = 301
	force = true

[[redirects]]
	from = "/library/*"
	to = "/components/:splat"
	status = 301
	force = true

[[redirects]]
	from = "/style-guide/*"
	to = "/design-guidelines/:splat"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/status-system"
	to = "/patterns/status-system"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/notifications"
	to = "/patterns/notifications"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/panes"
	to = "/patterns/panes"
	status = 301
	force = true

[[redirects]]
	from = "/components/validation"
	to = "/patterns/forms-and-validation"
	status = 301
	force = true

[[redirects]]
	from = "/components/toggle"
	to = "/components/switch"
	status = 301
	force = true

[[redirects]]
	from = "/components/validation"
	to = "/patterns/forms-and-validation"
	status = 301
	force = true

[[redirects]]
	from = "/tt-c-service-ux-design/about-the-tt-c-designs"
	to = "/ttc-service-ux-design/about-the-ttc-designs"
	status = 301
	force = true

[[redirects]]
	from = "/tt-c-service-ux-design/tt-c-monitor"
	to = "/ttc-service-ux-design/ttc-monitor"
	status = 301
	force = true

[[redirects]]
	from = "/tt-c-service-ux-design/tt-c-command"
	to = "/ttc-service-ux-design/ttc-command"
	status = 301
	force = true

[[redirects]]
	from = "/tt-c-service-ux-design/tt-c-investigate"
	to = "/ttc-service-ux-design/ttc-investigate"
	status = 301
	force = true

[[redirects]]
	from = "/components/drop-down"
	to = "/components/select"
	status = 301
	force = true

[[redirects]]
	from = "/getting-started/readme"
	to = "/getting-started/"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/compliance"
	to = "/compliance"
	status = 301
	force = true

[[redirects]]
	from = "/components/dialog-box"
	to = "/components/dialog"
	status = 301
	force = true

[[redirects]]
	from = "/components/sign-in"
	to = "/patterns/sign-in"
	status = 301
	force = true

[[redirects]]
	from = "/patterns/validation"
	to = "/patterns/forms-and-validation"
	status = 301
	force = true

[[redirects]]
	from = "/components/spectrum-analyzer"
	to = "/"
	status = 301
	force = true

[[redirects]]
	from = "/compliance"
	to = "/compliance/astro-design-compliance"
	status = 301
	force = true

[[redirects]]
	from = "/compliance/r2c2-design-compliance"
	to = "/compliance/astro-design-compliance"
	status = 301
	force = true


[[redirects]]
	from = "/egs-design-compliancee"
	to = "/compliance/astro-design-compliance"
	status = 301
	force = true

[[redirects]]
	from = "/components/readme/"
	to = "/components/getting-started/"
	status = 301
	force = true

[[redirects]]
	from = "/components/pop-up-menu/"
	to = "/patterns/pop-up-menu/"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/color/"
	to = "/design-tokens/getting-started/"
	status = 301
	force = true

[[redirects]]
	from = "/service-specific-ux-design/"
	to = "/case-studies/service-specific-ux-design/"
	status = 301
	force = true

[[redirects]]
	from = "/grm-service-ux-design/about-the-grm-designs/"
	to = "/case-studies/grm-service-ux-design/about-the-grm-designs/"
	status = 301
	force = true

[[redirects]]
	from = "/ttc-service-ux-design/about-the-ttc-designs/"
	to = "/case-studies/ttc-service-ux-design/about-the-ttc-designs/"
	status = 301
	force = true

[[redirects]]
	from = "/fd-service-ux-design/about-the-fd-designs/"
	to = "/case-studies/fd-service-ux-design/about-the-fd-designs/"
	status = 301
	force = true

[[redirects]]
	from = "/migration/"
	to = "/releases/migration/"
	status = 301
	force = true

[[redirects]]
	from = "/downloads/"
	to = "/resources/downloads/"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/glossary/"
	to = "/resources/glossary/"
	status = 301
	force = true

[[redirects]]
	from = "/design-process/research/"
	to = "/resources/research/"
	status = 301
	force = true

[[redirects]]
	from = "/design-process/ui-design/"
	to = "/resources/ui-design/"
	status = 301
	force = true

[[redirects]]
	from = "/design-process/visual-design/"
	to = "/resources/visual-design/"
	status = 301
	force = true

[[redirects]]
	from = "/design-process/ux-assessments/"
	to = "/resources/ux-assessments/"
	status = 301
	force = true

[[redirects]]
	from = "/community/propose-a-change/"
	to = "/support/propose-a-change/"
	status = 301
	force = true

[[redirects]]
	from = "/community/content-policy/"
	to = "/support/content-policy/"
	status = 301
	force = true

[[redirects]]
	from = "/icon-library/"
	to = "/components/icon-library/"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/typography/"
	to = "/foundations/typography/"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/theme/"
	to = "/foundations/theme/"
	status = 301
	force = true

[[redirects]]
	from = "/design-guidelines/grid/"
	to = "/foundations/grid/"
	status = 301
	force = true

# Edge Functions Configuration
# Stage 1: Added but not activated on existing routes yet

# Test route for Edge Function authentication (Stage 3)
# ACTIVE - Testing edge function protection
[[edge_functions]]
  path = "/test-protected/*"
  function = "auth-guard"

# Content gating for documentation (Stage 5)
# ACTIVE - Serving different content based on authentication
[[edge_functions]]
  path = "/components/*"
  function = "content-gate"

# Block direct access to gated content (Stage 5)
# ACTIVE - Prevents direct access to premium content
[[edge_functions]]
  path = "/gated/*"
  function = "block-gated"

# Protected auth routes (Stage 4)
# ACTIVE - Edge protection on authenticated routes
[[edge_functions]]
  path = "/auth/dashboard/*"
  function = "auth-guard"

[[edge_functions]]
  path = "/auth/profile/*"
  function = "auth-guard"
